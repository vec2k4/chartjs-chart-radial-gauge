<!DOCTYPE html>
<html>
<head>
  <title>Radial Gauge Chart</title>
  <script src="../node_modules/chart.js/dist/Chart.bundle.js"></script>
  <script src="../build/Chart.RadialGauge.umd.js"></script>
  <script src="./utils.js"></script>
  <style>

    canvas {
      -moz-user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }
  </style>
</head>

<body>
  <div id="canvas-holder" style="width:100%"><canvas id="chart-area"></canvas></div>
  <button id="randomizeData">Randomize Data</button>
  <script>
    var randomScalingFactor = function () {
      return Math.round(Math.random() * 8000);
    };
    Chart.defaults.global.defaultFontFamily = 'Verdana';

    var ctx = document.getElementById('chart-area').getContext('2d');

    //var labelFunc = new Function('v', 'o', '' +
    //  '     var val = v[0];' +
    //  '     var unit = "W";' +
    //  '     if (val > 1000) {' +
    //  '       val = (val / 1000).toFixed(2);' +
    //  '       unit = "kW";' +
    //  '     }' +
    //  '     return val + " " + unit;');

    var labelFunc = eval('(' +
      'function (v, o) {' +
      '  var val = v[0];' +
      '  var unit = "W";' +
      '  if (val > 1000) {' +
      '    val = (val / 1000).toFixed(2).replace(".", ",");' +
      '    unit = "kW";' +
      '  }' +
      '  return val + " " + unit;' +
      '})');

    var config = {
      type: 'radialGauge',
      data: {
        labels: ['M1', 'M2', 'M3'],
        datasets: [
          {
            data: [900, 500, 300],
            backgroundColor: ['#00ff00', '#ff0000', '#0000ff'],
            borderWidth: 0,
            label: 'Score'
          }
        ]
      },
      options: {
        responsive: true,
        legend: {},
        title: {
          display: false,
          text: 'Radial gauge chart'
        },
        centerPercentage: 80,
        padding: 35,
        arcPadding: function (index, outerRadius, innerRadius) {
          return (outerRadius - innerRadius) * index / 10
        },

        centerArea: {
          //fontSize: '1em',
          text: labelFunc
        },
        roundedCorners: false,
        domain: [0, 10000],
        rotation: Math.PI, // Standard
        circumference: Math.PI, // Standard
        radialScale: {
          //ticks: [0, 0.25, 0.5, 0.75, 1],
          ticks: [0, 0.2, 0.4, 0.6, 0.8, 1],
          label: function (v) {
            return v / 1000 + ' kW';
          },
          spacing: 20
        }
      }
    };

    window.onload = function () {
      var ctx = document.getElementById('chart-area').getContext('2d');
      window.myRadialGauge = new Chart(ctx, config);
    };

    document.getElementById('randomizeData').addEventListener('click', function () {
      config.data.datasets.forEach(function (dataset) {
        //dataset.data = dataset.data.map(function() {
        //  return randomScalingFactor();
        //});

        var val = randomScalingFactor();
        dataset.data = [val + 100, val - 50, val];
      });

      window.myRadialGauge.update();
    });
  </script>
</body>
</html>
